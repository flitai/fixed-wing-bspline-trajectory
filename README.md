# 障碍环境下固定翼无人机B 样条避障轨迹生成算法

该算法描述了一种为固定翼无人机在障碍物环境中生成**安全**、**平滑**且**动力学可行**的B样条轨迹的完整流程。其核心思想是采用“前端插值”和“后端优化”相结合的层次化策略。

---
## 算法目标与输入

该算法的主要目标是将一个由初步路径搜索（如A*）生成的稀疏、不平滑的离散路径点，转化为一条无人机可以实际飞行的连续轨迹。

**核心输入**包括：
* **初始离散路径点** `{P_0, P_1, ..., P_N}`。
* **二维障碍物栅格地图**，并预先计算好**距离场（Distance Field）**，用于快速查询任意点到最近障碍物的距离。
* **固定翼无人机动力学参数**，如最小/最大速度、最大加速度和最小转弯半径（最大曲率）。

---
## 算法流程

### 1. 前端：初始控制点生成

此阶段的目的是为B样条生成一组满足基本安全和速度约束的初始控制点。

1.  **计算最大允许间距**: 遍历初始路径的每一段，根据该段与障碍物的最近距离 `d_c` 和无人机最大速度，计算出后续B样条控制点之间允许的最大间距 `r_max`。这一步是为了初步利用B样条的**凸包特性**进行避障。
2.  **等距插值**: 如果原始路径段的长度超过了 `r_max`，就在该段内进行线性插值，插入足够多的新点，确保所有相邻控制点的间距都小于 `r_max`。
3.  **检查与合并**: 检查并合并间距过近的控制点，以防止轨迹速度低于无人机的**最小飞行速度** `v_min`。

### 2. 后端：非线性优化

这是算法的核心，通过调整控制点的位置来对轨迹进行精细打磨，使其同时满足所有约束。

* **优化变量**: B样条的内部控制点（首尾各3个点固定，以保证起点和终点的状态）。
* **成本函数**: 构造一个加权和形式的综合成本函数 `J(q)`，目标是使其最小化。
* **求解**: 文档建议使用成熟的非线性优化库（如 IPOPT, NLopt）来求解该问题，因为它们能有效处理复杂的约束，保证解的可行性。

### 3. 输出：轨迹离散化

优化完成后，得到一组最优的控制点 `Q*`。
1.  用 `Q*` 构建最终的B样条曲线 `S*(t)`。
2.  按照设定的时间间隔 `Δt` 对该连续曲线进行采样，生成包含位置、速度、加速度信息的一系列离散轨迹点 `{S_k}`。
3.  将该离散轨迹序列传递给无人机的飞控系统进行跟踪执行。

---
## 算法特点总结

* **兼顾安全与动力学**: 将避障要求和飞机的物理限制统一在一个优化框架内，确保了轨迹的**可飞行性**。
* **利用B样条优势**: 巧妙利用B样条的凸包特性和局部可修改性，使避障和优化过程更加高效。
* **层次化与可扩展**: “前端粗调、后端精调”的结构使问题得以简化。该算法框架也可方便地扩展至三维空间。
